<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pyro Predictor - Ember Realm</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../styles.css"> <!-- Link to your external CSS file -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
</head>
<body>
<br>
<br>
<div id="header-container"></div>
    <h1>Run Pyro Predictor</h1>
        <button onclick="runPrediction()">Predict</button>
            <p id="result">Waiting...</p>
            <script>
                let model;
                let scalerStats;
                const labels = ['Low', 'Moderate', 'High', 'Very High', 'Extreme'];

                async function loadEverything() {
                    try {
                        console.log("Loading model!");
                        model = await tf.loadLayersModel('/model.json');
                        console.log("Model loaded, loading scaler");
                        const res = await fetch('/scaler_stats.json');
                        scalerStats = await res.json();
                        console.log("Model and scaler loaded.");
                    } catch (e) {
                        console.error("Failed to load model or scaler:", e);
                    }
                }


                function normalizeInput(inputArray, mins, maxs) {
                    return inputArray.map((val, i) => {
                        return (val - mins[i]) / (maxs[i] - mins[i]);
                    });
                }
            
                async function predictFireDanger(input) {
                    if (!model || !scalerStats) {
                        alert("Model or scaler not loaded yet!");
                        return;
                    }
            
                    const normInput = normalizeInput(input, scalerStats.mins, scalerStats.maxs);
                    const inputTensor = tf.tensor2d([normInput]); // shape [1, 9]
                    const prediction = model.predict(inputTensor);
                    const result = prediction.argMax(-1); // get index of highest probability
                    const predictedClass = (await result.data())[0]; // value 0-4
                    return predictedClass;
                }
            
                async function runPrediction() {
                    const exampleInput = [78, 45, 60, 0.1, 30, 20, 15, 800, 3];  // Example data
                    const predictedClass = await predictFireDanger(exampleInput);
                    if (predictedClass !== undefined) {
                        document.getElementById("result").innerText =
                            `Predicted Fire Danger Level: ${labels[predictedClass]}`;
                    }
                }
                console.log("About to load model");
                window.addEventListener('load', loadEverything);

            </script>
        <script src="/loadHeader.js"></script>
        <script src="/animations.js"></script>
    </body>
</html>
